var _ = require('lodash');
var assert = require('assert');
var checker = require('../index');
var istanbul = require('istanbul');
var sinon = require('sinon');

describe('checkThreshold', function() {
    it('checks percentage threshold passes', function() {
        var coverage = { total: 125, covered: 75, skipped: 0, pct: 60 };
        assert.deepEqual(checker.checkThreshold(60, coverage), { failed: false, value: 60 });
    });

    it('checks percentage threshold fails', function() {
        var coverage = { total: 125, covered: 75, skipped: 0, pct: 60 };
        assert.deepEqual(checker.checkThreshold(80, coverage), { failed: true, value: 60 });
    });

    it('checks gap threshold passes', function() {
        var coverage = { total: 50, covered: 40, skipped: 0, pct: 80 };
        assert.deepEqual(checker.checkThreshold(-10, coverage), { failed: false, value: -10 });
    });

    it('checks gap threshold fails', function() {
        var coverage = { total: 50, covered: 40, skipped: 0, pct: 80 };
        assert.deepEqual(checker.checkThreshold(-5, coverage), { failed: true, value: -10 });
    });

    it('skips thresholds which are false', function() {
        var coverage = { total: 50, covered: 40, skipped: 0, pct: 80 };
        var expected = { failed: false, skipped: true };
        assert.deepEqual(checker.checkThreshold(null, coverage), expected);
        assert.deepEqual(checker.checkThreshold(undefined, coverage), expected);
        assert.deepEqual(checker.checkThreshold(false, coverage), expected);
        assert.deepEqual(checker.checkThreshold(0, coverage), expected);
    });
});

describe('checkThresholds', function() {
    it('checks all thresholds', function() {
        var thresholds = { lines: -20, statements: 60, functions: -50, branches: 66 };
        var coverage = {
            lines: { total: 100, covered: 90, skipped: 0, pct: 90 },
            statements: { total: 120, covered: 60, skipped: 0, pct: 50 },
            functions: { total: 80, covered: 20, skipped: 0, pct: 25 },
          